<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Datos ORA/ORAPC - Sala Situacional</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        
        :root {
            /* Paleta de Colores Profesional */
            --color-primary: #2563EB; /* Azul corporativo */
            --color-primary-hover: #1D4ED8;
            --color-background: #F8F9FA; /* Fondo gris muy claro */
            --color-surface: #FFFFFF; /* Superficie (Tarjetas/Formulario) */
            --color-text: #334155; /* Texto gris oscuro */
            --color-text-light: #64748B;
            --color-border: #E2E8F0; /* Borde sutil */
            --container-bg: #EBF8FF; /* Azul muy claro para el contenedor principal */
            --color-focus-ring: rgba(37, 99, 235, 0.2);

            /* Dark Mode Variables */
            --dm-color-background: #1A202C; /* Dark background */
            --dm-color-surface: #2D3748; /* Dark surface */
            --dm-color-text: #E2E8F0; /* Light text */
            --dm-color-text-light: #A0AEC0; /* Lighter gray text */
            --dm-color-border: #4A5568; /* Darker border */
            --dm-container-bg: #2D3748; /* Dark container background */
            --dm-color-primary: #63B3ED; /* Lighter blue for dark mode primary */
            --dm-color-primary-hover: #4299E1;
            --dm-color-focus-ring: rgba(99, 179, 237, 0.3);

            /* Estilos */
            --border-radius-m: 6px; /* Bordes ligeramente m√°s suaves */
            --border-radius-l: 12px;
            --shadow-subtle: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-medium: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            --font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--color-background);
            background: linear-gradient(to bottom, #1e3a8a, #93c5fd); /* Degradado de azul oscuro a claro */
            padding: 30px 20px;
            display: flex;
            justify-content: center;
            margin: 0;
        }
        body, .form-section, input, select, textarea, .tab-link { transition: background-color 0.3s, color 0.3s, border-color 0.3s; }

        .container {
            background-color: #EBF8FF; /* Azul muy claro para el contenedor principal */
            padding: 40px;
            border-radius: var(--border-radius-l);
            box-shadow: var(--shadow-medium);
            width: 100%;
            max-width: 1100px; /* Ancho m√°ximo para el formulario */
        }

        /* Contenedor para elementos del encabezado (t√≠tulo y fecha/hora) */
        .header-container {
            display: flex;
            flex-wrap: wrap; /* Permite que los elementos se envuelvan en pantallas peque√±as */
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--color-border);
            margin-bottom: 30px;
        }

        h1 {
            padding-bottom: 15px;
            margin-bottom: 30px;
            font-weight: 600;
            text-align: center; /* Centrar el t√≠tulo principal */
            font-size: 1.8em;
            flex-grow: 1; /* Permite que el t√≠tulo se centre correctamente */
            border-bottom: none; /* Quitar el borde individual */
            margin-bottom: 0; /* Quitar el margen individual */
        }

        #datetime-display {
            font-weight: 600; /* M√°s audaz */
            color: var(--color-text); /* Color de texto principal */
            font-size: 1.2em; /* M√°s grande */
            white-space: nowrap; /* Evita que la fecha y hora se partan */
            background-color: var(--color-surface); /* Fondo sutil */
            padding: 8px 12px;
            border-radius: var(--border-radius-m);
            border: 1px solid var(--color-border);
        }

        /* Estilos para el bot√≥n de cambio de tema y sus iconos SVG */
        #theme-toggle {
            background-color: var(--color-surface);
            border: 1px solid var(--color-border);
            color: var(--color-text-light);
        }
        #theme-toggle:hover {
            background-color: var(--color-border);
        }
        #theme-toggle svg { width: 20px; height: 20px; fill: currentColor; }
        .moon-icon { display: none; }
        body.dark-mode .sun-icon { display: none; }
        body.dark-mode .moon-icon { display: block; }
        body.dark-mode #theme-toggle { background-color: var(--dm-color-surface); border-color: var(--dm-color-border); color: var(--dm-color-text-light); }
        body.dark-mode #theme-toggle:hover { background-color: var(--dm-color-border); }

        /* Contenedor de Secci√≥n del Formulario (Tarjeta) */
        .form-section {
            background-color: var(--color-surface);
            padding: 20px;
            margin-bottom: 20px;
            border-radius: var(--border-radius-m);
            border: 1px solid var(--color-border);
            transition: box-shadow 0.2s, border-color 0.2s;
        }

        .form-section:focus-within {
             /* Efecto Hover/Focus sutil (Elevaci√≥n) */
            box-shadow: var(--shadow-medium);
            border-color: var(--color-primary);
        }

        h2 {
            font-size: 1.4em;
            color: var(--color-primary);
            margin-bottom: 15px;
            font-weight: 500;
        }

        /* Estilo para los campos de entrada */
        .form-group {
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 500;
            margin-bottom: 5px;
            color: var(--color-text-light);
            font-size: 0.95em;
        }

        input[type="text"], input[type="number"], select, textarea {
            padding: 10px 12px;
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius-m);
            font-size: 1em;
            transition: border-color 0.2s, box-shadow 0.2s, background-color 0.3s, color 0.3s;
            background-color: var(--color-surface);
            width: 100%;
            box-sizing: border-box;
        }

        input[type="text"]:focus, input[type="number"]:focus, select:focus, textarea:focus {
            border-color: var(--color-primary);
            outline: none;
            box-shadow: 0 0 0 3px var(--color-focus-ring);
        }

        /* Estilo del bot√≥n (similar al de Windows) */
        .btn-primary {
            background-color: var(--color-primary);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: var(--border-radius-m);
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: background-color 0.2s, box-shadow 0.2s;
            margin-top: 20px;
        }

        .btn-primary:hover {
            background-color: var(--color-primary-hover);
        }

        .btn-primary:active {
            background-color: var(--color-primary);
        }

        /* Estilos para el layout de columnas (Sistema de Grilla B√°sico) */
        .grid-3-cols {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .grid-4-cols {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .grid-2-cols {
            display: grid;
            grid-template-columns: 1fr; /* Base para m√≥vil */
            gap: 20px;
        }

        /* Estilo para el √°rea de mensaje de guardado */
        #message {
            margin-top: 20px;
            padding: 15px;
            border-radius: var(--border-radius-m);
            color: #004578;
            background-color: #EBF4F9;
            border: 1px solid #BFE4F5;
            display: none; /* Oculto por defecto */
        }

        /* Estilos para botones adicionales */
        .btn-secondary {
            background-color: #6B7280; /* Gris neutro */
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: var(--border-radius-m);
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: background-color 0.2s, box-shadow 0.2s;
        }

        .btn-secondary:hover {
            background-color: #4B5563;
        }

        .btn-danger {
            background-color: #EF4444; /* Rojo de advertencia */
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: var(--border-radius-m);
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: background-color 0.2s, box-shadow 0.2s;
        }

        .btn-danger:hover {
            background-color: #DC2626;
        }

        /* Estilos para tipos de mensaje */
        #message.message-success {
            color: #047857; /* Green text */
            background-color: #D1FAE5; /* Light green background */
            border-color: #6EE7B7; /* Green border */
        }

        #message.message-danger {
            color: #B91C1C; /* Red text */
            background-color: #FEE2E2; /* Light red background */
            border-color: #FCA5A5; /* Red border */
        }

        #message.message-info {
            color: #1E40AF; /* Blue text */
            background-color: #DBEAFE; /* Light blue background */
            border-color: #93C5FD; /* Blue border */
        }

        /* Estilos para la navegaci√≥n por pesta√±as */
        .tab-navigation {
            display: flex;
            border-bottom: 2px solid var(--color-border);
            margin-bottom: 30px;
        }

        .tab-link {
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            background-color: transparent;
            font-size: 1em;
            font-weight: 500;
            color: var(--color-text-light);
            border-bottom: 3px solid transparent;
            margin-bottom: -2px; /* Alinea con el borde inferior del contenedor */
        }

        .tab-link.active {
            color: var(--color-primary);
            border-bottom-color: var(--color-primary);
        }

        .tab-content { display: none; }
        .tab-content.active { display: block; }
    </style>
    <style>
        /* Dark Mode Overrides */
        body.dark-mode {
            background: linear-gradient(to bottom, #0a111f, #2c5282); /* Degradado m√°s oscuro */
            color: var(--dm-color-text);
        }

        body.dark-mode .container {
            background-color: var(--dm-container-bg);
        }

        body.dark-mode .header-container {
            border-bottom-color: var(--dm-color-border);
        }

        body.dark-mode h1 {
            color: var(--dm-color-text);
        }

        body.dark-mode #datetime-display {
            color: var(--dm-color-text);
            background-color: var(--dm-color-surface);
            border-color: var(--dm-color-border);
        }

        body.dark-mode .form-section {
            background-color: var(--dm-color-surface);
            border-color: var(--dm-color-border);
        }

        body.dark-mode .form-section:focus-within {
            border-color: var(--dm-color-primary);
            box-shadow: 0 0 0 3px var(--dm-color-focus-ring);
        }

        body.dark-mode h2 {
            color: var(--dm-color-primary);
        }

        body.dark-mode label {
            color: var(--dm-color-text-light);
        }

        body.dark-mode input[type="text"],
        body.dark-mode input[type="number"],
        body.dark-mode select,
        body.dark-mode textarea {
            background-color: var(--dm-color-surface);
            border-color: var(--dm-color-border);
            color: var(--dm-color-text);
        }

        body.dark-mode input[type="text"]:focus,
        body.dark-mode input[type="number"]:focus,
        body.dark-mode select:focus,
        body.dark-mode textarea:focus {
            border-color: var(--dm-color-primary);
            box-shadow: 0 0 0 3px var(--dm-color-focus-ring);
        }

        body.dark-mode .btn-primary { background-color: var(--dm-color-primary); }
        body.dark-mode .btn-primary:hover { background-color: var(--dm-color-primary-hover); }
        body.dark-mode .btn-primary:active { background-color: var(--dm-color-primary); }

        body.dark-mode .btn-secondary { background-color: #4A5568; color: var(--dm-color-text); }
        body.dark-mode .btn-secondary:hover { background-color: #2D3748; }

        body.dark-mode .btn-danger { background-color: #E53E3E; }
        body.dark-mode .btn-danger:hover { background-color: #C53030; }

        body.dark-mode #message.message-success { color: #68D391; background-color: #2F855A; border-color: #48BB78; }
        body.dark-mode #message.message-danger { color: #FC8181; background-color: #C53030; border-color: #E53E3E; }
        body.dark-mode #message.message-info { color: #90CDF4; background-color: #3182CE; border-color: #4299E1; }

        body.dark-mode .tab-navigation { border-bottom-color: var(--dm-color-border); }
        body.dark-mode .tab-link { color: var(--dm-color-text-light); }
        body.dark-mode .tab-link.active { color: var(--dm-color-primary); border-bottom-color: var(--dm-color-primary); }
    </style>
    <style>

        /* --- Base (M√≥vil) --- */
        .header-container {
            flex-direction: column; 
            gap: 15px;
            text-align: center;
        }

        .header-container > div {
            align-items: center; 
        }

        .tab-navigation {
            overflow-x: auto; 
            white-space: nowrap;
        }

        .grid-3-cols, .grid-4-cols {
            grid-template-columns: 1fr; /* Una sola columna en m√≥viles */
        }

        .grid-2-cols {
            grid-template-columns: 1fr; /* Una sola columna en m√≥viles */
        }

        .form-actions {
            flex-direction: column; /* Apila los botones de acci√≥n */
            gap: 15px;
        }

        .container {
            padding: 20px; /* Menos padding en m√≥viles */
        }

        /* --- Tablet (min-width: 768px) --- */
        @media (min-width: 768px) {
            .header-container {
                flex-direction: row; /* Vuelve a la fila en tablets */
            }
            .grid-2-cols {
                grid-template-columns: repeat(2, 1fr);
            }
            .grid-3-cols {
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            }
            .grid-4-cols {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }
            .form-actions {
                flex-direction: row; /* Botones en fila */
            }
        }
    </style>
</head>
<body>

<script>
    // Funci√≥n para verificar la autenticaci√≥n del usuario.
    function checkAuth() {
        // Si el indicador 'isAuthenticated' no es 'true', redirige al login.
        // Se usa location.replace para que la p√°gina actual no se guarde en el historial de sesi√≥n,
        // impidiendo que el usuario pueda volver con el bot√≥n "Atr√°s".
        if (sessionStorage.getItem('isAuthenticated') !== 'true') {
            window.location.replace('login.html');
        }
    }

    // Ejecutar la verificaci√≥n al cargar la p√°gina por primera vez.
    checkAuth();

    // A√±adir un listener al evento 'pageshow'.
    // Esto asegura que la verificaci√≥n se ejecute tambi√©n cuando el usuario navega
    // hacia atr√°s desde el cach√© del navegador (bfcache).
    window.addEventListener('pageshow', (event) => {
        // La propiedad 'persisted' es true si la p√°gina se carga desde el cach√©.
        if (event.persisted) {
            checkAuth();
        }
    });
</script>

    <div class="container">
        <div class="header-container">
            <h1>DATOS ORA/ORAPC - SALA SITUACIONAL</h1>
            <div style="display: flex; flex-direction: column; align-items: flex-end; gap: 10px;">
                <div id="datetime-display"></div>
                <button type="button" id="theme-toggle" class="btn-secondary" style="margin-top: 0; padding: 8px 12px;">
                    <!-- Icono de Luna (para cambiar a modo oscuro) -->
                    <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21.64,13.14C20.97,13.14 20.3,13.42 19.84,13.88C19.38,14.34 19.1,15.01 19.1,15.68C19.1,17.58 20.58,19.06 22.48,19.06C22.86,19.06 23.24,19 23.58,18.88C22.91,21.41 20.56,23.25 17.75,23.25C13.5,23.25 10,19.75 10,15.5C10,11.25 13.5,7.75 17.75,7.75C20.56,7.75 22.91,9.59 23.58,12.12C23.24,12 22.86,11.94 22.48,11.94C22.02,11.94 21.56,12.06 21.1,12.28C21.44,12.52 21.64,12.82 21.64,13.14Z"></path></svg>
                    <!-- Icono de Sol (para cambiar a modo claro) -->
                    <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,7C9.24,7 7,9.24 7,12C7,14.76 9.24,17 12,17C14.76,17 17,14.76 17,12C17,9.24 14.76,7 12,7ZM12,15C10.34,15 9,13.66 9,12C9,10.34 10.34,9 12,9C13.66,9 15,10.34 15,12C15,13.66 13.66,15 12,15ZM12,2L12,4C16.42,4 20,7.58 20,12C20,16.42 16.42,20 12,20C7.58,20 4,16.42 4,12C4,7.58 7.58,4 12,4L12,2ZM12,0C6.48,0 2,4.48 2,10C2,15.52 6.48,20 12,20C17.52,20 22,15.52 22,10C22,4.48 17.52,0 12,0Z"/></svg>
                </button>
            </div>
        </div>
        <form id="dataForm">

            <!-- Navegaci√≥n de Pesta√±as -->
            <div class="tab-navigation">
                <button type="button" class="tab-link active" data-tab="tab-1">Identificaci√≥n y Poder Popular</button>
                <button type="button" class="tab-link" data-tab="tab-2">Social y Pol√≠tica</button>
                <button type="button" class="tab-link" data-tab="tab-3">Infraestructura</button>
                <button type="button" class="tab-link" data-tab="tab-4">Productivo y Observaciones</button>
            </div>

            <!-- Contenido de las Pesta√±as -->
            <div id="tab-1" class="tab-content active">
                <div class="form-section">
                    <h2>1. Identificaci√≥n Geogr√°fica y Administrativa</h2>
                    <div class="grid-4-cols">
                        <div class="form-group">
                            <label>N√∫mero de Registro (Autom√°tico)</label>
                            <p id="registro-automatico" style="font-weight: bold; font-size: 1.1em; color: var(--color-primary); margin-top: 5px;">-</p>
                        </div>
                        <div class="form-group"><label for="estado">Estado</label><input type="text" id="estado" name="estado" required></div>
                        <div class="form-group"><label for="municipio">Municipio</label><input type="text" id="municipio" name="municipio" required></div>
                        <div class="form-group"><label for="parroquia">Parroquia</label><input type="text" id="parroquia" name="parroquia" required></div>
                        <div class="form-group"><label for="nombre_orapc">Nombre de la ORAPC</label><input type="text" id="nombre_orapc" name="nombre_orapc"></div>
                        <div class="form-group"><label for="nombre_comuna">Nombre de la Comuna Registrada</label><input type="text" id="nombre_comuna" name="nombre_comuna"></div>
                        <div class="form-group"><label for="nombre_circuito">Nombre del Circuito Comunal</label><input type="text" id="nombre_circuito" name="nombre_circuito"></div>
                        <div class="form-group"><label for="densidad_poblacional">Densidad Poblacional</label><input type="number" id="densidad_poblacional" name="densidad_poblacional" min="0" value="0"></div>
                    </div>
                </div>

                <div class="form-section">
                    <h2>2. Organizaci√≥n del Poder Popular</h2>
                    <div class="grid-3-cols">
                        <div class="form-group"><label for="cant_consejos_comunales">Cant. Consejos Comunales</label><input type="number" id="cant_consejos_comunales" name="cant_consejos_comunales" min="0" value="0"></div>
                        <div class="form-group"><label for="cant_circuitos_comunales">Cant. Circuitos Comunales</label><input type="number" id="cant_circuitos_comunales" name="cant_circuitos_comunales" min="0" value="0"></div>
                        <div class="form-group"><label for="cant_salas_autogobierno">Cant. Salas de Autogobierno</label><input type="number" id="cant_salas_autogobierno" name="cant_salas_autogobierno" min="0" value="0"></div>
                        <div class="form-group"><label for="cant_comunas_registradas">Cant. Comunas Registradas</label><input type="number" id="cant_comunas_registradas" name="cant_comunas_registradas" min="0" value="0"></div>
                        <div class="form-group"><label for="cant_jueces_paz">Cant. Jueces y Juezas de Paz</label><input type="number" id="cant_jueces_paz" name="cant_jueces_paz" min="0" value="0"></div>
                        <div class="form-group"><label for="otros_poder_popular">Otros que se Tengan</label><input type="text" id="otros_poder_popular" name="otros_poder_popular"></div>
                    </div>

                    <h3>Datos de los Responsables de Sala de Autogobierno</h3>
                    <div class="grid-3-cols">
                        <div class="form-group"><label for="resp_nombre">Nombre y Apellido</label><input type="text" id="resp_nombre" name="resp_nombre"></div>
                        <div class="form-group"><label for="resp_cedula">C√©dula</label><input type="text" id="resp_cedula" name="resp_cedula"></div>
                        <div class="form-group"><label for="resp_telefono">Tel√©fono</label><input type="text" id="resp_telefono" name="resp_telefono"></div>
                    </div>

                    <h3>Comit√©s de Base y Estructuras Comunitarias</h3>
                    <div class="grid-4-cols">
                        <div class="form-group"><label for="comites_salud">Comit√©s de Salud</label><input type="number" id="comites_salud" name="comites_salud" min="0" value="0"></div>
                        <div class="form-group"><label for="comites_tierra">Comit√©s de Tierra Urbana</label><input type="number" id="comites_tierra" name="comites_tierra" min="0" value="0"></div>
                        <div class="form-group"><label for="comites_campo_semilla">Comit√© de Campo/Semilla</label><input type="number" id="comites_campo_semilla" name="comites_campo_semilla" min="0" value="0"></div>
                        <div class="form-group"><label for="comites_campesino_pescador">Comit√© Campesino/Pescador</label><input type="number" id="comites_campesino_pescador" name="comites_campesino_pescador" min="0" value="0"></div>
                        <div class="form-group"><label for="comites_barrios">Comit√©s de Barrios</label><input type="number" id="comites_barrios" name="comites_barrios" min="0" value="0"></div>
                        <div class="form-group"><label for="comites_indigenas">Comit√©s Ind√≠genas</label><input type="number" id="comites_indigenas" name="comites_indigenas" min="0" value="0"></div>
                        <div class="form-group"><label for="comites_afro">Comit√©s de Afrodescendientes</label><input type="number" id="comites_afro" name="comites_afro" min="0" value="0"></div>
                        <div class="form-group"><label for="comites_mujeres">Comit√© de Mujeres</label><input type="number" id="comites_mujeres" name="comites_mujeres" min="0" value="0"></div>
                        <div class="form-group"><label for="comites_juventud">Comit√© de la Juventud</label><input type="number" id="comites_juventud" name="comites_juventud" min="0" value="0"></div>
                        <div class="form-group"><label for="comites_justicia_paz">Comit√© de Justicia de Paz Comunal</label><input type="number" id="comites_justicia_paz" name="comites_justicia_paz" min="0" value="0"></div>
                    </div>
                    <div class="form-group"><label for="otros_comites">Otros Comit√©s en el Punto y C√≠rculo</label><input type="text" id="otros_comites" name="otros_comites"></div>
                </div>
            </div>

            <div id="tab-2" class="tab-content">
                <div class="form-section">
                    <h2>3. Misiones y Grandes Misiones Socialistas</h2>
                    <div class="grid-3-cols">
                        <div class="form-group"><label for="misiones_bases">Bases de Misiones Socialistas</label><input type="number" id="misiones_bases" name="misiones_bases" min="0" value="0"></div>
                        <div class="form-group"><label for="misiones_gmvv">Urbanismos de la GMVV</label><input type="number" id="misiones_gmvv" name="misiones_gmvv" min="0" value="0"></div>
                        <div class="form-group"><label for="misiones_casas_alimentacion">Casas de Alimentaci√≥n</label><input type="number" id="misiones_casas_alimentacion" name="misiones_casas_alimentacion" min="0" value="0"></div>
                        <div class="form-group"><label for="misiones_cocineras">Cocineras de la Patria</label><input type="number" id="misiones_cocineras" name="misiones_cocineras" min="0" value="0"></div>
                        <div class="form-group"><label for="misiones_hogares_patria">Comit√©s de Hogares de la Patria</label><input type="number" id="misiones_hogares_patria" name="misiones_hogares_patria" min="0" value="0"></div>
                        <div class="form-group"><label for="misiones_multifamiliar">Comit√© Multifamiliar</label><input type="number" id="misiones_multifamiliar" name="misiones_multifamiliar" min="0" value="0"></div>
                    </div>
                    <div class="form-group"><label for="misiones_otros">Otros que se tengan en su territorio</label><input type="text" id="misiones_otros" name="misiones_otros"></div>
                </div>

                <div class="form-section">
                    <h2>4. Pol√≠tica</h2>
                    <div class="grid-3-cols">
                        <div class="form-group"><label for="politica_ubch">Cantidad de UBCH</label><input type="number" id="politica_ubch" name="politica_ubch" min="0" value="0"></div>
                        <div class="form-group"><label for="politica_jefes_psuv">Jefes de Comunidades del PSUV</label><input type="number" id="politica_jefes_psuv" name="politica_jefes_psuv" min="0" value="0"></div>
                        <div class="form-group"><label for="politica_jpsuv">JPSUV</label><input type="number" id="politica_jpsuv" name="politica_jpsuv" min="0" value="0"></div>
                    </div>
                    <h3>GPPSB</h3>
                    <div class="grid-4-cols"></div>

                    <div class="form-group"><label for="politica_otros">Otros que se Tengan en el Territorio</label><input type="text" id="politica_otros" name="politica_otros"></div>
                </div>
            </div>

            <div id="tab-3" class="tab-content">
                <div class="form-section">
                    <h2>5. Instituciones</h2>
                    <div class="grid-3-cols">
                        <div class="form-group"><label for="inst_alcaldia">Alcald√≠a</label><select id="inst_alcaldia" name="inst_alcaldia"><option value="">Seleccionar...</option><option value="Oficialista">Oficialista</option><option value="Opositora">Opositora</option></select></div>
                        <div class="form-group"><label for="inst_gobernacion">Gobernaci√≥n</label><select id="inst_gobernacion" name="inst_gobernacion"><option value="">Seleccionar...</option><option value="Oficialista">Oficialista</option><option value="Opositora">Opositora</option></select></div>
                        <div class="form-group"><label for="inst_consejo_municipal">Consejo Municipal</label><input type="text" id="inst_consejo_municipal" name="inst_consejo_municipal"></div>
                    </div>
                    <div class="form-group"><label for="inst_publicas">Nombre de Instituciones P√∫blicas</label><textarea id="inst_publicas" name="inst_publicas" rows="2"></textarea></div>
                    <div class="form-group"><label for="inst_privadas">Nombre de Instituciones Privadas</label><textarea id="inst_privadas" name="inst_privadas" rows="2"></textarea></div>
                    <div class="form-group"><label for="inst_bancos_publicos">Nombre de Bancos P√∫blicos</label><input type="text" id="inst_bancos_publicos" name="inst_bancos_publicos"></div>
                    <div class="form-group"><label for="inst_bancos_privados">Nombre de Bancos Privados</label><input type="text" id="inst_bancos_privados" name="inst_bancos_privados"></div>
                    <div class="form-group"><label for="inst_otras">Otras Instituciones a Mencionar</label><input type="text" id="inst_otras" name="inst_otras"></div>
                </div>

                <div class="form-section">
                    <h2>6. Educaci√≥n üéì</h2>
                    <div class="grid-4-cols">
                        <div class="form-group"><label for="edu_simoncitos">Espacios Simonsitos</label><input type="number" id="edu_simoncitos" name="edu_simoncitos" min="0" value="0"></div>
                        <div class="form-group"><label for="edu_preescolar_pub">Preescolares P√∫blicos</label><input type="number" id="edu_preescolar_pub" name="edu_preescolar_pub" min="0" value="0"></div>
                        <div class="form-group"><label for="edu_preescolar_priv">Preescolares Privados</label><input type="number" id="edu_preescolar_priv" name="edu_preescolar_priv" min="0" value="0"></div>
                        <div class="form-group"><label for="edu_escuelas_pub">Escuelas P√∫blicas</label><input type="number" id="edu_escuelas_pub" name="edu_escuelas_pub" min="0" value="0"></div>
                        <div class="form-group"><label for="edu_escuelas_priv">Escuelas Privadas</label><input type="number" id="edu_escuelas_priv" name="edu_escuelas_priv" min="0" value="0"></div>
                        <div class="form-group"><label for="edu_liceos_pub">Liceos P√∫blicos</label><input type="number" id="edu_liceos_pub" name="edu_liceos_pub" min="0" value="0"></div>
                        <div class="form-group"><label for="edu_liceos_priv">Liceos Privados</label><input type="number" id="edu_liceos_priv" name="edu_liceos_priv" min="0" value="0"></div>
                        <div class="form-group"><label for="edu_univ_pub">Universidades P√∫blicas</label><input type="number" id="edu_univ_pub" name="edu_univ_pub" min="0" value="0"></div>
                        <div class="form-group"><label for="edu_univ_priv">Universidades Privadas</label><input type="number" id="edu_univ_priv" name="edu_univ_priv" min="0" value="0"></div>
                        <div class="form-group"><label for="edu_proteccion_nna">Consejos de Protecci√≥n NNA</label><input type="number" id="edu_proteccion_nna" name="edu_proteccion_nna" min="0" value="0"></div>
                    </div>
                    <div class="form-group"><label for="edu_otras">Otras</label><input type="text" id="edu_otras" name="edu_otras"></div>
                </div>

                <div class="form-section">
                    <h2>7. Salud ‚öïÔ∏è</h2>
                    <div class="grid-4-cols">
                        <div class="form-group"><label for="salud_barrio_adentro">M√≥dulo Barrio Adentro T1</label><input type="number" id="salud_barrio_adentro" name="salud_barrio_adentro" min="0" value="0"></div>
                        <div class="form-group"><label for="salud_cdi">CDI</label><input type="number" id="salud_cdi" name="salud_cdi" min="0" value="0"></div>
                        <div class="form-group"><label for="salud_cat">CAT</label><input type="number" id="salud_cat" name="salud_cat" min="0" value="0"></div>
                        <div class="form-group"><label for="salud_ambulatorios">Ambulatorios</label><input type="number" id="salud_ambulatorios" name="salud_ambulatorios" min="0" value="0"></div>
                        <div class="form-group"><label for="salud_clinicas_priv">Cl√≠nicas Privadas</label><input type="number" id="salud_clinicas_priv" name="salud_clinicas_priv" min="0" value="0"></div>
                        <div class="form-group"><label for="salud_clinicas_pop">Cl√≠nicas Populares</label><input type="number" id="salud_clinicas_pop" name="salud_clinicas_pop" min="0" value="0"></div>
                    </div>
                    <div class="form-group"><label for="salud_hospitales">Nombre de Hospitales</label><input type="text" id="salud_hospitales" name="salud_hospitales"></div>
                </div>
            </div>

            <div id="tab-4" class="tab-content">
                <div class="form-section">
                    <h2>8. Productivos</h2>
                    <div class="grid-3-cols">
                        <div class="form-group"><label for="prod_emprendedores">Cant. de Emprendedores</label><input type="number" id="prod_emprendedores" name="prod_emprendedores" min="0" value="0"></div>
                        <div class="form-group"><label for="prod_panaderias">Panader√≠as Comunales</label><input type="number" id="prod_panaderias" name="prod_panaderias" min="0" value="0"></div>
                        <div class="form-group"><label for="prod_mercados">Mercados Municipales</label><input type="number" id="prod_mercados" name="prod_mercados" min="0" value="0"></div>
                        <div class="form-group">
                            <label for="prod_activo">¬øSe encuentra activo su emprendimiento?</label>
                            <select id="prod_activo" name="prod_activo"><option value="">Seleccionar...</option><option value="Si">S√≠</option><option value="No">No</option></select>
                        </div>
                        <div class="form-group">
                            <label for="prod_registrado">¬øSe encuentra registrado su emprendimiento?</label>
                            <select id="prod_registrado" name="prod_registrado"><option value="">Seleccionar...</option><option value="Si">S√≠</option><option value="No">No</option></select>
                        </div>
                        <div class="form-group">
                            <label for="prod_financiamiento">¬øUsted ha recibido alg√∫n tipo de financiamiento?</label>
                            <select id="prod_financiamiento" name="prod_financiamiento"><option value="">Seleccionar...</option><option value="Si">S√≠</option><option value="No">No</option></select>
                        </div>
                    </div>
                    <div class="grid-2-cols">
                        <div class="form-group"><label for="prod_tipo_emprendimiento">Tipo de emprendimiento, especifique</label><textarea id="prod_tipo_emprendimiento" name="prod_tipo_emprendimiento" rows="4"></textarea></div>
                        <div class="form-group"><label for="prod_rutas_turisticas">Rutas Tur√≠sticas en el Punto y C√≠rculo</label><input type="text" id="prod_rutas_turisticas" name="prod_rutas_turisticas"></div>
                    </div>
                </div>

                <div class="form-section">
                    <h2>9. Observaciones Generales</h2>
                    <div class="form-group">
                        <label for="observaciones">Observaciones Generales</label>
                        <textarea id="observaciones" name="observaciones" rows="4"></textarea>
                    </div>
                </div>
            </div>

            <!-- Botones de Acci√≥n -->
            <div class="form-actions">
                <div id="message"></div>
                <button type="button" class="btn-secondary" id="logoutBtn">Cerrar Sesi√≥n</button>
                <button type="button" class="btn-danger" id="clearAllBtn">Limpiar Todo el Registro</button>
                <button type="submit" class="btn-primary">üíæ Guardar Registro</button>
            </div>
        </form>
    </div>

    <script>

        const form = document.getElementById('dataForm'); // Definir 'form' una vez
        const body = document.body;

        // --- Dark/Light Mode Toggle ---
        const themeToggleBtn = document.getElementById('theme-toggle');

        // Cargar la preferencia de tema guardada
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            body.classList.add('dark-mode');
        }

        themeToggleBtn.addEventListener('click', () => {
            body.classList.toggle('dark-mode');
            if (body.classList.contains('dark-mode')) {
                localStorage.setItem('theme', 'dark');
            } else {
                localStorage.setItem('theme', 'light');
            }
        });

        // --- L√≥gica del Formulario ---
        form.addEventListener('submit', async function(event) {
            event.preventDefault(); // Evita el env√≠o tradicional del formulario
            const formData = new FormData(form);
            const n_registro = document.getElementById('registro-automatico').textContent;
            if (n_registro === '-') {
                showMessage('Por favor, ingrese un estado para generar el n√∫mero de registro.', 'danger');
                return;
            }
            const data = {};
            
            // Recolectar todos los datos del formulario
            for (const [key, value] of formData.entries()) {
                // Intenta convertir n√∫meros
                if (form.elements[key].type === 'number') {
                    data[key] = parseInt(value) || 0;
                } else {
                    data[key] = value.trim();
                }
            }

            // A√±adir el n√∫mero de registro autom√°tico a los datos
            const registroData = {
                ...Object.fromEntries(formData.entries()),
                n_registro: n_registro
            };

            // Construir el cuerpo del correo electr√≥nico
            let emailBody = "Datos del Registro:\n";
            for (const key in registroData) {
                emailBody += `${key}: ${registroData[key]}\n`;
            }

            // Abrir el cliente de correo electr√≥nico
            const subject = `Nuevo Registro ORA/ORAPC - N¬∞ ${n_registro}`;
            const mailtoUri = `mailto:data2023equidad@gmail.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(emailBody)}`;
            window.location.href = mailtoUri;
            showMessage('‚úÖ Abriendo cliente de correo para enviar el registro. Por favor, revise su bandeja de salida.', 'success');
        });

        // Event listener para el bot√≥n "Cerrar Sesi√≥n"
        document.getElementById('logoutBtn').addEventListener('click', function() {
            // Elimina la bandera de autenticaci√≥n de la sesi√≥n
            sessionStorage.removeItem('isAuthenticated');
            // Redirige al usuario a la p√°gina de login
            window.location.href = 'login.html';
        });

        // Event listener para el bot√≥n "Limpiar Todo el Registro"
        document.getElementById('clearAllBtn').addEventListener('click', function() {
            const confirmation = confirm('¬°ADVERTENCIA! Est√°s a punto de eliminar TODOS los registros guardados. Esta acci√≥n es irreversible. ¬øEst√°s seguro de que deseas continuar?');
            if (confirmation) { // Esta l√≥gica tambi√©n deber√≠a moverse al backend
                // fetch('/limpiar-todo', { method: 'POST' }); // Ejemplo de c√≥mo se har√≠a
                showMessage('üóëÔ∏è Todos los registros han sido eliminados.', 'danger');
            } else {
                showMessage('Operaci√≥n de limpieza cancelada.', 'info');
            }
        });

        /**
         * Muestra un mensaje temporal al usuario.
         * @param {string} msg - El mensaje a mostrar.
         * @param {'success'|'danger'|'info'} type - El tipo de mensaje para aplicar estilos (success, danger, info).
         */
        function showMessage(msg, type = 'success') {
            const messageElement = document.getElementById('message');
            messageElement.textContent = msg;
            messageElement.style.display = 'block';
            
            // Eliminar clases de tipo anteriores y a√±adir la nueva
            messageElement.classList.remove('message-success', 'message-danger', 'message-info');
            messageElement.classList.add(`message-${type}`);

            // Ocultar mensaje despu√©s de 6 segundos
            setTimeout(() => {
                messageElement.style.display = 'none';
                messageElement.classList.remove('message-success', 'message-danger', 'message-info'); // Limpiar clases al ocultar
            }, 6000);
        }

        // L√≥gica para la navegaci√≥n por pesta√±as
        const tabLinks = document.querySelectorAll('.tab-link');
        const tabContents = document.querySelectorAll('.tab-content');

        tabLinks.forEach(link => {
            link.addEventListener('click', () => {
                const tabId = link.getAttribute('data-tab');

                // Desactivar todas las pesta√±as y contenidos
                tabLinks.forEach(item => item.classList.remove('active'));
                tabContents.forEach(item => item.classList.remove('active'));

                // Activar la pesta√±a y contenido seleccionados
                link.classList.add('active');
                document.getElementById(tabId).classList.add('active');
            });
        });

        // --- L√≥gica para ID autom√°tico y Fecha/Hora ---

        const estadoInput = document.getElementById('estado');
        const registroDisplay = document.getElementById('registro-automatico');

        // PEGA AQU√ç LA URL GENERADA AL PUBLICAR TU HOJA COMO CSV
        // Reemplaza el texto de abajo con la URL que generaste al publicar tu hoja de c√°lculo como CSV.
        const googleSheetURL = 'PEGA_AQUI_TU_URL_DE_PUBLICACION_CSV'; // <-- ¬°Aqu√≠ debes pegar el enlace CSV!

        // Funci√≥n que se encarga de generar el ID
        const triggerIdGeneration = function() {
            const estado = estadoInput.value.trim();
            // No hacer nada si el estado no tiene al menos 4 caracteres
            if (estado.length < 4) {
                return;
            }

            const diminutivo = estado.substring(0, 4).toLowerCase();
            const fecha = new Date().toLocaleDateString('es-ES', { day:'2-digit', month:'2-digit', year:'2-digit' }).replace(/\//g, '');
            
            // --- L√ìGICA MODIFICADA: Pedir el correlativo al servidor ---
            function obtenerCorrelativo() {
                if (!googleSheetURL || googleSheetURL.includes('PEGA_AQUI')) {
                    console.error("URL de Google Sheets no configurada. Por favor, edita el archivo index.html y a√±ade la URL de publicaci√≥n correcta.");
                    registroDisplay.textContent = 'Error de Config.';
                    return;
                }
                Papa.parse(googleSheetURL, {
                    download: true,
                    header: true,
                    complete: function(results) {
                        if (results && results.data) {
                            const registrosFiltrados = results.data.filter(row => row.estado && row.estado.toLowerCase() === estado.toLowerCase());
                            const correlativo = registrosFiltrados.length + 1;
                            const correlativoFormateado = correlativo.toString().padStart(2, '0');
                            registroDisplay.textContent = `${fecha}-${diminutivo}${correlativoFormateado}`;
                        } else {
                            console.error("Error al leer los datos de Google Sheets:", results.errors);
                            registroDisplay.textContent = 'Error';
                        }
                    },
                    error: function(error) {
                        console.error("Error al descargar el archivo CSV:", error);
                        registroDisplay.textContent = 'Error';
                    }
                });
            }
            // Llamar a la funci√≥n que hace el trabajo
            obtenerCorrelativo();
        };

        // Usar el evento 'input' que es m√°s robusto que 'keyup' y funciona con autocompletado.
        estadoInput.addEventListener('input', triggerIdGeneration);

        // Leer los datos de Google Sheets al cargar la p√°gina
        window.addEventListener('DOMContentLoaded', (event) => {
            // Si el navegador autocompleta el campo de estado al cargar,
            // llamamos directamente a la funci√≥n para generar el ID.
            if (estadoInput.value.trim() !== '') {
                triggerIdGeneration();
            }
        });

        // Actualizar la fecha y hora cada segundo
        const datetimeDisplay = document.getElementById('datetime-display');
        function updateDateTime() {
            const now = new Date();
            // Formato de fecha: DD/MM/YYYY
            const dateOptions = { year: 'numeric', month: '2-digit', day: '2-digit' };
            const formattedDate = now.toLocaleDateString('es-ES', dateOptions);

            // Formato de hora con segundos: HH:MM:SS
            const timeOptions = { hour: '2-digit', minute: '2-digit', second: '2-digit' };
            const formattedTime = now.toLocaleTimeString('es-ES', timeOptions);
            
            datetimeDisplay.textContent = `${formattedDate} ${formattedTime}`;
        }

        setInterval(updateDateTime, 1000);
        updateDateTime(); // Llamada inicial

    </script>

</body>
</html>